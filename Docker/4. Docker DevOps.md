# Docker DevOps
### 安裝 default-jdk
```sh
[lvmh@localhost]$ sudo apt install default-jdk
[lvmh@localhost]$ sudo vi /etc/environment
JAVA_HOME="/usr/lib/jvm/default-java"
[lvmh@localhost]$ source /etc/environment
[lvmh@localhost]$ echo $JAVA_HOME
/usr/lib/jvm/default-java
[lvmh@localhost]$ sudo vi /home/lvmh/.bashrc
source /etc/environment
```

### 下載 myderby 網站應用開發套件
```sh
[lvmh@localhost]$ cd Desktop
[lvmh@localhost]$ mkdir myderby
[lvmh@localhost]$ curl https://start.spring.io/starter.tgz -d dependencies=web,lombok,data-jpa,derby,jdbc -d packaging=war -d type=gradle-project -d language=java -d applicationName=Derby -d artifactId=dt -d groupId=tw -d bootVersion=2.1.1.RELEASE --output myderby.tgz

[lvmh@localhost]$ tar xvfz myderby.tgz -C myderby
```

### 設定 Port 為 8888
```sh
[lvmh@localhost]$ cd myderby
[lvmh@localhost]$ echo 'server.port=8888' > src/main/resources/application.properties
```

##### 設計網站首頁
```sh
[lvmh@localhost]$ echo '<h1>Welcome to Spring Boot</h1>' > src/main/resources/static/index.html
[lvmh@localhost]$ ./gradlew bootrun
...
<=========----> 75% EXECUTING [3m 4s]
```

##### 開啟另一個終端機, 執行以下命令
```
[lvmh@localhost]$ curl http://localhost:8888
<h1>Welcome to Spring Boot</h1>
```

### 撰寫 MyDB.java 程式
```sh
[lvmh@localhost]$ vi src/main/java/tw/dt/MyDB.java
package tw.dt;

import org.springframework.web.bind.annotation.*;
import java.sql.*;
import java.net.InetAddress;
import java.net.UnknownHostException;

@RestController
public class MyDB {
    private static final String driver = "org.apache.derby.jdbc.EmbeddedDriver" ;
    private static final String url = "jdbc:derby:test;create=true" ;

    @GetMapping("/db")
    public String get() throws Exception {
        String info; 
        Connection con = null ; DatabaseMetaData dbmd = null ; Class.forName(driver) ;
        con = DriverManager.getConnection(url); dbmd = con.getMetaData();
        info = "Database Name  = " + dbmd.getDatabaseProductName() + "<br>" ;
        info = info + "Database Version = " + dbmd.getDatabaseProductVersion() + "<br>" ;
        info = info + "Driver Name  = " + dbmd.getDriverName() + "<br>" ; 
        return info;
    }

    @GetMapping("/hostname")
    public String root() throws Exception { 
        InetAddress ip = InetAddress.getLocalHost();
        return "Hostname : " + ip.getHostName() + "\n";
    }
}
```

### 測試 MyDB.java 程式
```sh
[lvmh@localhost]$ ./gradlew bootrun
...
<=========----> 75% EXECUTING [3m 4s]
```

##### 開啟另一個終端機視窗
```sh
[lvmh@localhost]$ curl http://localhost:8888/db
Database Name  = Apache Derby<br>Database Version = 10.14.2.0 - (1828579)<br>Driver Name  = Apache Derby Embedded JDBC Driver<br>

[lvmh@localhost]$ curl http://localhost:8888;echo ""
<h1>Welcome to Spring Boot</h1>

[lvmh@localhost]$ curl http://localhost:8888/hostname;echo ""
Hostname : ubuntu
```

### 撰寫 MyCars.java 程式
```sh
[lvmh@localhost]$ vi src/main/java/tw/dt/MyCars.java
package tw.dt;

import org.springframework.web.bind.annotation.*;
import java.sql.*;
import java.net.InetAddress;
import java.net.UnknownHostException;

@RestController
public class MyDB {
    private static final String driver = "org.apache.derby.jdbc.EmbeddedDriver";
    private static final String url = "jdbc:derby:e40;create=true";

    @GetMapping(value={"/derby/cars/create"})
    public String create() {
       Connection con = null ;
       Statement st = null;
       try {
            Class.forName(driver) ;
            con = DriverManager.getConnection(url);
            st = con.createStatement();
            st.executeUpdate("CREATE TABLE CARS (ID VARCHAR(3) PRIMARY KEY,"
                    + "NAME VARCHAR(30), PRICE VARCHAR(5))");
            return "cars table created";
        } catch (Exception ex) {
          return ex.getMessage();
        } finally {
            try {
                if (st != null) { st.close(); }
                if (con != null) { con.close(); }
            } catch (SQLException ex) {
              return ex.getMessage();
            }
        }
    }
}
```

### 測試 MyCars.java 程式
```sh
[lvmh@localhost]$ ./gradlew bootrun
```

##### 開啟另一個終端機視窗
```
[lvmh@localhost]$ curl http://localhost:8888/db/cars/drop;echo
'DROP TABLE' cannot be performed on 'CARS' because it does not exist.
[lvmh@localhost]$ curl http://localhost:8888/db/cars/create;echo
cars table created
[lvmh@localhost]$ curl 'http://localhost:8888/db/cars/insert?id=123&name=star&price=123';echo
Add Records ok
[lvmh@localhost]$ curl 'http://localhost:8888/db/cars/insert?id=123&name=star&price=123';echo
insert error
[lvmh@localhost]$ curl 'http://localhost:8888/db/cars/insert?id=234&name=sun&price=123';echo
Add Records ok
[lvmh@localhost]$ curl http://localhost:8888/db/cars/list;echo
123,star,123<br>234,sun,123<br>
```

# 自製 Application Image